{
    "version": 3,
    "sources": [
        "..\\..\\src\\controller\\rest.js"
    ],
    "names": [
        "assert",
        "require",
        "module",
        "exports",
        "think",
        "Controller",
        "_REST",
        "constructor",
        "ctx",
        "resource",
        "getResource",
        "id",
        "getId",
        "isFunction",
        "model",
        "modelInstance",
        "__before",
        "controller",
        "split",
        "pop",
        "get",
        "isString",
        "isNumber",
        "last",
        "path",
        "slice",
        "getAction",
        "data",
        "pk",
        "where",
        "find",
        "success",
        "select",
        "postAction",
        "post",
        "isEmpty",
        "fail",
        "insertId",
        "add",
        "deleteAction",
        "rows",
        "delete",
        "affectedRows",
        "putAction",
        "update",
        "__call"
    ],
    "mappings": ";;AAAA,MAAMA,SAASC,QAAQ,QAAR,CAAf;;AAEAC,OAAOC,OAAP,GAAiB,cAAcC,MAAMC,UAApB,CAA+B;AAC9C,aAAWC,KAAX,GAAmB;AACjB,WAAO,IAAP;AACD;;AAEDC,cAAYC,GAAZ,EAAiB;AACf,UAAMA,GAAN;AACA,SAAKC,QAAL,GAAgB,KAAKC,WAAL,EAAhB;AACA,SAAKC,EAAL,GAAU,KAAKC,KAAL,EAAV;AACAZ,WAAOI,MAAMS,UAAN,CAAiB,KAAKC,KAAtB,CAAP,EAAqC,+BAArC;AACA,SAAKC,aAAL,GAAqB,KAAKD,KAAL,CAAW,KAAKL,QAAhB,CAArB;AACD;AACDO,aAAW,CAAE;AACb;;;;AAIAN,gBAAc;AACZ,WAAO,KAAKF,GAAL,CAASS,UAAT,CAAoBC,KAApB,CAA0B,GAA1B,EAA+BC,GAA/B,EAAP;AACD;AACDP,UAAQ;AACN,UAAMD,KAAK,KAAKS,GAAL,CAAS,IAAT,CAAX;AACA,QAAIT,OAAOP,MAAMiB,QAAN,CAAeV,EAAf,KAAsBP,MAAMkB,QAAN,CAAeX,EAAf,CAA7B,CAAJ,EAAsD;AACpD,aAAOA,EAAP;AACD;AACD,UAAMY,OAAO,KAAKf,GAAL,CAASgB,IAAT,CAAcN,KAAd,CAAoB,GAApB,EAAyBO,KAAzB,CAA+B,CAAC,CAAhC,EAAmC,CAAnC,CAAb;AACA,QAAIF,SAAS,KAAKd,QAAlB,EAA4B;AAC1B,aAAOc,IAAP;AACD;AACD,WAAO,EAAP;AACD;AACKG,WAAN,GAAkB;AAAA;;AAAA;AAChB,UAAIC,IAAJ;AACA,UAAI,MAAKhB,EAAT,EAAa;AACX,cAAMiB,KAAK,MAAKb,aAAL,CAAmBa,EAA9B;AACAD,eAAO,MAAM,MAAKZ,aAAL,CAAmBc,KAAnB,CAAyB,EAAE,CAACD,EAAD,GAAM,MAAKjB,EAAb,EAAzB,EAA4CmB,IAA5C,EAAb;AACA,eAAO,MAAKC,OAAL,CAAaJ,IAAb,CAAP;AACD;AACDA,aAAO,MAAM,MAAKZ,aAAL,CAAmBiB,MAAnB,EAAb;AACA,aAAO,MAAKD,OAAL,CAAaJ,IAAb,CAAP;AARgB;AASjB;AACD;;;;AAIMM,YAAN,GAAmB;AAAA;;AAAA;AACjB,YAAML,KAAK,OAAKb,aAAL,CAAmBa,EAA9B;AACA,YAAMD,OAAO,OAAKO,IAAL,EAAb;AACA,aAAOP,KAAKC,EAAL,CAAP;AACA,UAAIxB,MAAM+B,OAAN,CAAcR,IAAd,CAAJ,EAAyB;AACvB,eAAO,OAAKS,IAAL,CAAU,eAAV,CAAP;AACD;AACD,YAAMC,WAAW,MAAM,OAAKtB,aAAL,CAAmBuB,GAAnB,CAAuBX,IAAvB,CAAvB;AACA,aAAO,OAAKI,OAAL,CAAa,EAAEpB,IAAI0B,QAAN,EAAb,CAAP;AARiB;AASlB;AACD;;;;AAIME,cAAN,GAAqB;AAAA;;AAAA;AACnB,UAAI,CAAC,OAAK5B,EAAV,EAAc;AACZ,eAAO,OAAKyB,IAAL,CAAU,cAAV,CAAP;AACD;AACD,YAAMR,KAAK,OAAKb,aAAL,CAAmBa,EAA9B;AACA,YAAMY,OAAO,MAAM,OAAKzB,aAAL,CAAmBc,KAAnB,CAAyB,EAAE,CAACD,EAAD,GAAM,OAAKjB,EAAb,EAAzB,EAA4C8B,MAA5C,EAAnB;AACA,aAAO,OAAKV,OAAL,CAAa,EAAEW,cAAcF,IAAhB,EAAb,CAAP;AANmB;AAOpB;AACD;;;;AAIMG,WAAN,GAAkB;AAAA;;AAAA;AAChB,UAAI,CAAC,OAAKhC,EAAV,EAAc;AACZ,eAAO,OAAKyB,IAAL,CAAU,cAAV,CAAP;AACD;AACD,YAAMR,KAAK,OAAKb,aAAL,CAAmBa,EAA9B;AACA,YAAMD,OAAO,OAAKO,IAAL,EAAb;AACAP,WAAKC,EAAL,IAAW,OAAKjB,EAAhB,CANgB,CAMI;AACpB,UAAIP,MAAM+B,OAAN,CAAcR,IAAd,CAAJ,EAAyB;AACvB,eAAO,OAAKS,IAAL,CAAU,eAAV,CAAP;AACD;AACD,YAAMI,OAAO,MAAM,OAAKzB,aAAL,CAAmBc,KAAnB,CAAyB,EAAE,CAACD,EAAD,GAAM,OAAKjB,EAAb,EAAzB,EAA4CiC,MAA5C,CAAmDjB,IAAnD,CAAnB;AACA,aAAO,OAAKI,OAAL,CAAa,EAAEW,cAAcF,IAAhB,EAAb,CAAP;AAXgB;AAYjB;AACDK,WAAS,CAAE;AApFmC,CAAhD",
    "file": "..\\..\\src\\controller\\rest.js",
    "sourcesContent": [
        "const assert = require('assert');\n\nmodule.exports = class extends think.Controller {\n  static get _REST() {\n    return true;\n  }\n\n  constructor(ctx) {\n    super(ctx);\n    this.resource = this.getResource();\n    this.id = this.getId();\n    assert(think.isFunction(this.model), 'this.model must be a function');\n    this.modelInstance = this.model(this.resource);\n  }\n  __before() {}\n  /**\n   * get resource\n   * @return {String} [resource name]\n   */\n  getResource() {\n    return this.ctx.controller.split('/').pop();\n  }\n  getId() {\n    const id = this.get('id');\n    if (id && (think.isString(id) || think.isNumber(id))) {\n      return id;\n    }\n    const last = this.ctx.path.split('/').slice(-1)[0];\n    if (last !== this.resource) {\n      return last;\n    }\n    return '';\n  }\n  async getAction() {\n    let data;\n    if (this.id) {\n      const pk = this.modelInstance.pk;\n      data = await this.modelInstance.where({ [pk]: this.id }).find();\n      return this.success(data);\n    }\n    data = await this.modelInstance.select();\n    return this.success(data);\n  }\n  /**\n   * put resource\n   * @return {Promise} []\n   */\n  async postAction() {\n    const pk = this.modelInstance.pk;\n    const data = this.post();\n    delete data[pk];\n    if (think.isEmpty(data)) {\n      return this.fail('data is empty');\n    }\n    const insertId = await this.modelInstance.add(data);\n    return this.success({ id: insertId });\n  }\n  /**\n   * delete resource\n   * @return {Promise} []\n   */\n  async deleteAction() {\n    if (!this.id) {\n      return this.fail('params error');\n    }\n    const pk = this.modelInstance.pk;\n    const rows = await this.modelInstance.where({ [pk]: this.id }).delete();\n    return this.success({ affectedRows: rows });\n  }\n  /**\n   * update resource\n   * @return {Promise} []\n   */\n  async putAction() {\n    if (!this.id) {\n      return this.fail('params error');\n    }\n    const pk = this.modelInstance.pk;\n    const data = this.post();\n    data[pk] = this.id; // rewrite data[pk] forbidden data[pk] !== this.id\n    if (think.isEmpty(data)) {\n      return this.fail('data is empty');\n    }\n    const rows = await this.modelInstance.where({ [pk]: this.id }).update(data);\n    return this.success({ affectedRows: rows });\n  }\n  __call() {}\n};"
    ]
}